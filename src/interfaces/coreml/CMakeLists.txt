IF (PROTOBUF_FOUND AND ENABLE_PROTOBUF)
	FILE(GLOB COREML_SRC "${CMAKE_CURRENT_SOURCE_DIR}/*.proto")
	FILE(MAKE_DIRECTORY "${CMAKE_CURRENT_BINARY_DIR}")
	FOREACH (SRC_FILE ${COREML_SRC})
		GET_FILENAME_COMPONENT(SRC_FILE_WE ${SRC_FILE} NAME_WE)
		SET(COMPILED_SRC "${CMAKE_CURRENT_BINARY_DIR}/coreml/${SRC_FILE_WE}")
		SET(COMPILED_SRC_H "${COMPILED_SRC}.pb.h")
		SET(COMPILED_SRC_CPP "${COMPILED_SRC}.pb.cpp")
		ADD_CUSTOM_COMMAND(
		    OUTPUT "${COMPILED_SRC_H}" "${COMPILED_SRC_CPP}"
		    COMMAND "${PROTOBUF_PROTOC_EXECUTABLE}"
		            "${SRC_FILE}"
		            --cpp_out "${CMAKE_CURRENT_BINARY_DIR}"
		            --proto_path "${CMAKE_CURRENT_SOURCE_DIR}"
		    COMMENT "Compiling CoreML Protobuf for ${SRC_FILE_WE}"
		)
		SET(PROTO_TARGET_NAME "CoreML_${SRC_FILE_WE}")
		ADD_CUSTOM_TARGET("${PROTO_TARGET_NAME}" DEPENDS "${COMPILED_SRC_H}" "${COMPILED_SRC_CPP}")
		ADD_DEPENDENCIES(libshogun "${PROTO_TARGET_NAME}")
	ENDFOREACH()
ELSE()
	MESSAGE(FATAL_ERROR "Protobuf is required for CoreML")
ENDIF()
